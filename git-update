#!/bin/bash
# Prunes tracking branches and updates dev & master
# If dev/master is checked out then the branch pulled,
# Otherwise it is fetched


#git update [--no-pull]
curBranch=$(git rev-parse --abbrev-ref HEAD)

fetches=" "
ffSelf="0"

for branch in "dev" "master"; do
    if [[ "$branch" == "$curBranch" ]]; then
        if [[ "$1" == "--no-pull" ]]; then
            echo "Refusing to update already checked out branch $branch due to --no-pull"
        else
            #git pull --ff-only --rebase --autostash origin
            fetches="$fetches $branch"
            ffSelf="1"
        fi
    else
        #git fetch origin $branch:$branch
        fetches="$fetches $branch:$branch"
    fi
done

git fetch origin --prune $fetches
if [[ ffSelf == "1" ]]; then
    git merge --ff-only "origin/$curBranch"
fi